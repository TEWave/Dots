<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown to 4:30 PM</title>
    
    <!-- Link to p5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    
    <style>
        body {
            background-color: white;
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
    </style>
</head>
<body>
    <script>
        let dots = [];
        const totalMinutes = 510;  // 8:00 AM to 4:30 PM is 510 minutes
        let startTime;
        let lastTimeChecked;
        let nextDotToDisappear = 0;  // Index of the next dot to disappear
        let flashingDotIndex = -1;  // Track which dot is currently flashing

        function setup() {
            createCanvas(windowWidth, windowHeight);
            initializeDots();
            startTime = millis();
            lastTimeChecked = getElapsedMinutes();
        }

        function draw() {
            background(255);  // Set background to white

            let currentMinute = getElapsedMinutes();
            
            // If a minute has passed, remove a dot and handle flashing
            if (currentMinute > lastTimeChecked) {
                lastTimeChecked = currentMinute;
                handleDotDisappearance();
            }

            // Display all dots
            for (let i = 0; i < dots.length; i++) {
                dots[i].display(i);
            }
        }

        // Calculate how many minutes have passed since 8:00 AM
        function getElapsedMinutes() {
            let now = new Date();
            let startOfDay = new Date(now);
            startOfDay.setHours(8, 0, 0, 0);  // Set time to 8:00 AM today

            let elapsedMillis = now - startOfDay;  // Elapsed time in milliseconds
            return Math.floor(elapsedMillis / 60000);  // Convert to minutes
        }

        // Initialize the dots array, one dot per minute
        function initializeDots() {
            const cols = Math.floor(Math.sqrt(totalMinutes)); // Number of columns based on sqrt(total dots)
            const rows = Math.ceil(totalMinutes / cols); // Number of rows to fit all dots
            const spacing = Math.min(width / cols, height / rows); // Adjust spacing based on screen size

            for (let i = 0; i < totalMinutes; i++) {
                let x = (i % cols) * spacing + spacing / 2;
                let y = Math.floor(i / cols) * spacing + spacing / 2;
                dots.push(new Dot(x, y));
            }
        }

        // Handle the disappearance of a dot and flashing effect
        function handleDotDisappearance() {
            if (nextDotToDisappear < dots.length) {
                // Flash the next dot for the last 60 seconds before it disappears
                if (nextDotToDisappear === dots.length - 60) {
                    flashingDotIndex = nextDotToDisappear;
                }

                // Remove the first dot in the array every minute
                dots.shift();
                nextDotToDisappear++;
            }
        }

        // Dot class to create and display dots
        class Dot {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = 10;  // Make the dots smaller
            }

            display(index) {
                noStroke();
                if (index === flashingDotIndex) {
                    // Flashing effect for the dot that is about to disappear
                    let alpha = (frameCount % 60 < 30) ? 255 : 0;  // Flash between visible and invisible
                    fill(0, alpha);  // Black color with flashing effect
                } else {
                    fill(0);  // Normal black dot
                }
                ellipse(this.x, this.y, this.size, this.size);
            }
        }
    </script>
</body>
</html>
